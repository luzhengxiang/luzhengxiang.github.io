---
title: JVM基础2
date: 2019-12-20 23:04:59
tags: [java, jvm]
---

# 1 Java虚拟机栈和栈帧

> 官网 :https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.6 <br>
栈帧:每个栈帧对应一个被调用的方法，可以理解为一个方法的运行空间。
 
 每个栈帧中包括局部变量表(Local Variables)、操作数栈(Operand Stack)、指向运行时常量池的引用(A reference to the run-time constant pool)、方法返回地址(Return Address)和附加信息。

> 局部变量表:方法中定义的局部变量以及方法的参数存放在这张表中 局部变量表中的变量不可直接使用，如需要使用的话，必须通过相关指令将其加载至操作数栈中作为操作数使用。

> 操作数栈:以压栈和出栈的方式存储操作数的

> 动态链接:每个栈帧都包含一个指向运行时常量池中该栈帧所属方法的引用，持有这个引用是为了支持方法调用过程中的动态 连接(Dynamic Linking)。

> 方法返回地址:当一个方法开始执行后,只有两种方式可以退出，一种是遇到方法返回的字节码指令;一种是遇见异常，并且 这个异常没有在方法体内得到处理。

![](/img/java/jvm/2/1.jpg)

# 2 堆栈之间的关系

## 2.1栈指向堆
如果在栈帧中有一个变量，类型为引用类型，比如Object obj=new Object()，这时候就是典型的栈中元素指向堆中的 对象。

![](/img/java/jvm/2/2.jpg)

## 2.2 方法区指向堆
方法区中会存放静态变量，常量等数据。如果是下面这种情况，就是典型的方法区中元素指向堆中的对象。

```
private static Object obj=new Object();
```
![](/img/java/jvm/2/3.jpg)

## 2.3 堆指向方法区
方法区中会包含类的信息，堆中会有对象，那怎么知道对象是哪个类创建的呢?
